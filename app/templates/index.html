<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
    />
    <title>Document</title>
  </head>
  <body>
    <div class="container">
      <div className="card card-custom" style="background-color: #00000012">
        <div className="card-header d-none">
          <h3 className="card-title"></h3>
        </div>
        <div className="card-body">
          <div class="text-center d-flex justify-content-center mb-5 pb-5">
            <div class="col-md-12">
              <img
                src="/media/myapp/voucher-frente.png"
                class="img-fluid w-25"
              />
            </div>
          </div>
          <div class="row justify-content-center">
            <div class="col-md-9">
              <div class="row">
                <!-- BEGIN:: GERAL -->
                <div class="col-md-12">
                  <div class="input-group mb-3">
                    <input
                      type="text"
                      class="form-control"
                      aria-describedby="button-addon2"
                      id="consult"
                      placeholder="Número de registro"
                    />
                    <button
                      class="btn btn-outline-success bg-info text-white"
                      type="button"
                      id="send"
                    >
                      Verificar
                    </button>
                  </div>
                </div>
                <div class="col-md-12">
                  <div class="form-floating">
                    <select class="form-control" id="hosp">
                      <option>Nome do hospede</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div
            class="row g-5 gap-5 m-5 p-5 d-flex justify-content-center"
            v-if="itsok == true"
          >
            <div class="col-md-10 bg-secondary p-5 rounded">
              <div class="row">
                <div class="col-6">
                  <div class="form-floating mb-5">
                    <input
                      type="text"
                      class="form-control"
                      id="reserv"
                      disabled
                    />
                    <label for="hosp_numeroreserva">Número da reserva</label>
                  </div>
                </div>
                <div class="col-6">
                  <div class="form-floating mb-5">
                    <input type="text" class="form-control" id="id" disabled />
                    <label for="geral_idsistema">ID San Island</label>
                  </div>
                </div>
                <p class="text-center h1 m-5 p-5">HOSPEDAGEM</p>
                <div class="col-6">
                  <div class="form-floating mb-5">
                    <input
                      type="text"
                      class="form-control"
                      id="category"
                      disabled
                    />
                    <label for="hosp_categoriapacote">Categoria</label>
                  </div>
                </div>
                <div class="col-6">
                  <div class="form-floating mb-5">
                    <input
                      type="text"
                      class="form-control"
                      id="pous"
                      disabled
                    />
                    <label for="hosp_nomepousada">Nome da Pousada</label>
                  </div>
                </div>
                <div class="col-6">
                  <div class="form-floating mb-5">
                    <input type="text" class="form-control" id="in" disabled />
                    <label for="hosp_dataentrada">Data IN</label>
                  </div>
                </div>
                <div class="col-6">
                  <div class="form-floating mb-5">
                    <input type="text" class="form-control" id="out" disabled />
                    <label for="hosp_datasaida">Data OUT</label>
                  </div>
                </div>
                <div class="col-12 my-5 py-5">
                  <table
                    class="table table-row-dashed table-row-gray-300 gy-2 bg-white rounded"
                  >
                    <thead>
                      <tr class="fw-bolder fs-6 text-gray-800">
                        <td>Tipo de quarto</td>
                        <td>Nº registro</td>
                        <td>Acompanhante de quarto</td>
                      </tr>
                    </thead>
                    <tbody class="p-5" id="query"></tbody>
                  </table>
                </div>
                <div class="col-12 d-none">
                  <div class="form-floating mb-3">
                    <label for="geral_observacao">Observação</label>
                  </div>
                </div>
                <div class="col-12 bg-white p-5 rounded">
                  <h5 class="text-center mb-3">
                    TRANSPORTE IDA E VOLTA | MORRO DE SÃO PAULO:
                  </h5>
                  <p>
                    Para você que se antecipou e comprou seu transfer de IDA e
                    RETORNO, nossa equipe entrará em contato para agendar seu
                    horário, de acordo com os horários disponíveis.
                  </p>
                  <p>
                    Se ainda não comprou, corra no
                    <a href="https://www.sanfolia.com" target="_blank"
                      >www.sanfolia.com</a
                    >
                    e garanta sua vaga, assim poderemos organizar sua logística.
                  </p>
                  <p>Nos vemos em Morro de São Paulo,</p>
                  <p>Equipe Logística</p>
                  <p>
                    <strong>Cel:</strong>
                    <a href="https://wa.me/5519994593637" target="_blank"
                      >(19) 99459-3637</a
                    >
                  </p>
                  <p>
                    <strong>Email:</strong>
                    <a href="mailto:sanconcierge.logistica@agmuller.com.br"
                      >sanconcierge.logistica@agmuller.com.br</a
                    >
                  </p>
                  <p class="fst-italic">SAN CONCIERGE</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script type="module">
      const consult = document.getElementById("consult");
      const send = document.getElementById("send");
      const hosp = document.getElementById("hosp");
      const reserv = document.getElementById("reserv");
      const id = document.getElementById("id");
      const category = document.getElementById("category");
      const pous = document.getElementById("pous");
      const indate = document.getElementById("in");
      const outdate = document.getElementById("out");
      const query = document.getElementById("query");

      function organizate(r, i, c, p, ind, o, data) {
        const indd = new Date(ind);
        const indf = `${(() => {
          if (indd.getDate() < 10) {
            return `0${indd.getDate()}`;
          }
          return indd.getDate();
        })()}/${(() => {
          if (indd.getMonth() + 1 < 10) {
            return `0${indd.getMonth() + 1}`;
          }
          return indd.getMonth() + 1;
        })()}/${indd.getFullYear()}`;

        const odd = new Date(o);
        const odf = `${(() => {
          if (odd.getDate() < 10) {
            return `0${odd.getDate()}`;
          }
          return odd.getDate();
        })()}/${(() => {
          if (odd.getMonth() + 1 < 10) {
            return `0${odd.getMonth() + 1}`;
          }
          return odd.getMonth() + 1;
        })()}/${odd.getFullYear()}`;

        reserv.value = r;
        id.value = i;
        category.value = c;
        pous.value = p;
        indate.value = indf;
        outdate.value = odf;

        if (data === null) {
          return;
        }

        const number = consult.value;
        document.querySelectorAll("#query tr").forEach((el) => el.remove());
        data.forEach((c) => {
          if (c.geral_numeroregistro === number) {
            const option = document.createElement("option");
            option.innerText = c.hosp_nomehospede;
            option.value = c.hosp_qtdevagas;
            hosp.appendChild(option);
          }

          if (c.hosp_nomehospede == null) {
            return;
          }

          const type = document.createElement("th");
          const register = document.createElement("th");
          const name = document.createElement("th");

          type.innerText = c.hosp_tipoquarto;
          register.innerText = c.geral_numeroregistro;
          name.innerText = c.hosp_nomehospede;

          const tr = document.createElement("tr");
          tr.appendChild(type);
          tr.appendChild(register);
          tr.appendChild(name);

          query.appendChild(tr);
        });
      }

      hosp.addEventListener("change", async () => {
        const id = hosp.value;
        const dataframe = await fetch(`/clients?hosp_qtdevagas=${id}`).then(
          (j) => j.json()
        );
        if (dataframe.length === 0) {
          return;
        }
        const client = dataframe.data[0];
        organizate(
          client.hosp_numeroreserva,
          client.geral_idsistema,
          client.hosp_categoriapacote,
          client.hosp_nomepousada,
          client.hosp_dataentrada,
          client.hosp_datasaida,
          null
        );
      });

      send.addEventListener("click", async () => {
        const number = consult.value;
        const dataframe = await fetch(
          `/clients?geral_numeroregistro=${number}`
        ).then((j) => j.json());

        const data = dataframe.data;

        if (data.length > 4 || data.length === 0) {
          return;
        }

        document.querySelectorAll("#hosp option").forEach((e) => e.remove());

        const client = data[0];
        organizate(
          client.hosp_numeroreserva,
          client.geral_idsistema,
          client.hosp_categoriapacote,
          client.hosp_nomepousada,
          client.hosp_dataentrada,
          client.hosp_datasaida,
          data
        );
      });
    </script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js"
      integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
